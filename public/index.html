<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice of Power</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous">
    <script src="node_modules/pdfjs-dist/build/pdf.js"></script>
    <script src="node_modules/pdfjs-dist/web/viewer.js"></script>
</head>
<body>
    <div class="left-panel">
        <img src="Voice_of_Power_logo_128x128_corrected.png" alt="Voice of Power Logo" class="logo">
        <h1>Voice of Power</h1>
        <div class="colorful-underline"></div>

        <input type="file" id="uploadBook" accept="application/pdf">
        <select id="voiceSelection">
            <option value="wataniVoice">Watani Stiner - Voice of Power (English)</option>
            <option value="wataniVoiceSpanish">Watani Stiner - Voice of Power (Spanish)</option>
            <option value="wataniVoiceFrench">Watani Stiner - Voice of Power (French)</option>
            <option value="wataniVoiceGerman">Watani Stiner - Voice of Power (German)</option>
            <option value="default">Default Voice</option>
            <option value="voice1">Voice 1</option>
            <option value="voice2">Voice 2</option>
        </select>
        <select id="languageSelection">
            <option value="en">English</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="de">German</option>
            <option value="zh">Chinese</option>
            <option value="ja">Japanese</option>
            <option value="ko">Korean</option>
            <option value="ru">Russian</option>
            <option value="ar">Arabic</option>
            <option value="hi">Hindi</option>
            <option value="pt">Portuguese</option>
            <option value="bn">Bengali</option>
            <option value="pa">Punjabi</option>
            <option value="id">Indonesian</option>
            <option value="vi">Vietnamese</option>
            <option value="it">Italian</option>
            <option value="tr">Turkish</option>
            <option value="pl">Polish</option>
            <option value="uk">Ukrainian</option>
            <option value="ro">Romanian</option>
            <option value="nl">Dutch</option>
            <option value="el">Greek</option>
            <option value="hu">Hungarian</option>
            <option value="sv">Swedish</option>
            <option value="cs">Czech</option>
            <option value="da">Danish</option>
            <option value="fi">Finnish</option>
            <option value="no">Norwegian</option>
            <option value="he">Hebrew</option>
            <option value="th">Thai</option>
            <option value="ms">Malay</option>
        </select>
        <select id="voiceSpeed">
            <option value="normal">Normal Speed</option>
            <option value="slow">Slow Speed</option>
            <option value="fast">Fast Speed</option>
        </select>
        <div class="control-buttons">
            <button id="playButton"><i class="fas fa-play"></i> Play</button>
            <button id="pauseButton"><i class="fas fa-pause"></i> Pause</button>
        </div>
    </div>
    <div class="right-panel">
        <div class="book-view" id="bookView">
            <!-- Display the uploaded book content here -->
            <iframe id="pdfViewer" style="width: 100%; height: 100%;"></iframe>
        </div>
        <div class="user-menu">
            <div class="user-icon" id="userIcon">U</div>
            <div class="dropdown-menu" id="userDropdown">
                <a href="#" id="loginLink">Login</a>
                <a href="#" id="signUpLink">Sign Up</a>
                <a href="#view-uploads" id="viewUploadsLink" style="display: none;">View Uploads</a>
                <a href="#upload-new-pdf" id="uploadNewPDFLink" style="display: none;">Upload New PDF</a>
                <a href="#settings" id="settingsLink" style="display: none;">Settings</a>
                <a href="#" id="logoutLink" style="display: none;">Logout</a>
            </div>
        </div>
    </div>

    <!-- Modal for Login and Sign Up -->
    <div id="authModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" id="closeAuthModal">&times;</span>
            <div id="loginFormContainer">
                <h2>Login</h2>
                <form id="loginForm">
                    <input type="email" name="email" placeholder="Email" required>
                    <input type="password" name="password" placeholder="Password" required>
                    <button type="submit">Login</button>
                </form>
                <p>Don't have an account? <a href="#" id="showSignUp">Sign Up</a></p>
            </div>
            <div id="signUpFormContainer" style="display: none;">
                <h2>Sign Up</h2>
                <form id="signUpForm">
                    <input type="text" name="name" placeholder="Name" required>
                    <input type="email" name="email" placeholder="Email" required>
                    <input type="password" name="password" placeholder="Password" required>
                    <button type="submit">Sign Up</button>
                </form>
                <p>Already have an account? <a href="#" id="showLogin">Login</a></p>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('playButton').addEventListener('click', function () {
            // Play functionality here
        });

        document.getElementById('pauseButton').addEventListener('click', function () {
            // Pause functionality here
        });

        // File upload
        document.getElementById('uploadBook').addEventListener('change', function () {
            const fileInput = this;
            const file = fileInput.files[0];

            if (file) {
                const formData = new FormData();
                formData.append('file', file);

                fetch('/upload', {
                    method: 'POST',
                    body: formData
                }).then(response => {
                    if (response.ok) {
                        return response.json(); // Expecting JSON response from server
                    } else {
                        throw new Error('File upload failed.');
                    }
                }).then(data => {
                    alert('File uploaded successfully.');
                    // Display the PDF
                    const pdfViewer = document.getElementById('pdfViewer');
                    pdfViewer.src = data.fileUrl; // Update src with the URL from the response
                }).catch(error => {
                    console.error(error);
                    alert('File upload failed. Please check your server and CORS configuration.');
                });
            }
        });

        // Toggle user dropdown menu
        document.getElementById('userIcon').addEventListener('click', function () {
            const userDropdown = document.getElementById('userDropdown');
            userDropdown.style.display = userDropdown.style.display === 'flex' ? 'none' : 'flex';
        });

        // Show login modal
        document.getElementById('loginLink').addEventListener('click', function () {
            document.getElementById('authModal').style.display = 'block';
            document.getElementById('loginFormContainer').style.display = 'block';
            document.getElementById('signUpFormContainer').style.display = 'none';
        });

        // Show sign-up modal
        document.getElementById('signUpLink').addEventListener('click', function () {
            document.getElementById('authModal').style.display = 'block';
            document.getElementById('loginFormContainer').style.display = 'none';
            document.getElementById('signUpFormContainer').style.display = 'block';
        });

        // Close modal
        document.getElementById('closeAuthModal').addEventListener('click', function () {
            document.getElementById('authModal').style.display = 'none';
        });

        // Switch to sign-up form
        document.getElementById('showSignUp').addEventListener('click', function () {
            document.getElementById('loginFormContainer').style.display = 'none';
            document.getElementById('signUpFormContainer').style.display = 'block';
        });

        // Switch to login form
        document.getElementById('showLogin').addEventListener('click', function () {
            document.getElementById('signUpFormContainer').style.display = 'none';
            document.getElementById('loginFormContainer').style.display = 'block';
        });

        // Handle login form submission
        document.getElementById('loginForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);

            fetch('/login', {
                method: 'POST',
                body: formData
            }).then(response => {
                if (response.ok) {
                    // Update UI on successful login
                    updateUserMenu(true);
                    document.getElementById('authModal').style.display = 'none';
                } else {
                    throw new Error('Login failed.');
                }
            }).catch(error => {
                console.error(error);
                alert('Login failed. Please try again.');
            });
        });

        // Handle sign-up form submission
        document.getElementById('signUpForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);

            const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                password: formData.get('password')
            };

            fetch('/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            }).then(response => {
                if (response.ok) {
                    // Update UI on successful sign-up
                    updateUserMenu(true);
                    document.getElementById('authModal').style.display = 'none';
                } else {
                    throw new Error('Sign-up failed.');
                }
            }).catch(error => {
                console.error(error);
                alert('Sign-up failed. Please try again.');
            });
        });

        function updateUserMenu(isLoggedIn) {
            if (isLoggedIn) {
                document.getElementById('loginLink').style.display = 'none';
                document.getElementById('signUpLink').style.display = 'none';
                document.getElementById('viewUploadsLink').style.display = 'block';
                document.getElementById('uploadNewPDFLink').style.display = 'block';
                document.getElementById('settingsLink').style.display = 'block';
                document.getElementById('logoutLink').style.display = 'block';
            } else {
                document.getElementById('loginLink').style.display = 'block';
                document.getElementById('signUpLink').style.display = 'block';
                document.getElementById('viewUploadsLink').style.display = 'none';
                document.getElementById('uploadNewPDFLink').style.display = 'none';
                document.getElementById('settingsLink').style.display = 'none';
                document.getElementById('logoutLink').style.display = 'none';
            }
        }

        document.getElementById('logoutLink').addEventListener('click', function () {
            fetch('/logout', {
                method: 'GET'
            }).then(() => {
                updateUserMenu(false);
            }).catch(error => {
                console.error(error);
                alert('Logout failed. Please try again.');
            });
        });

        // Initial check to update menu based on login state
        fetch('/check-login')
            .then(response => response.json())
            .then(data => {
                updateUserMenu(data.isLoggedIn);
            })
            .catch(error => {
                console.error('Error checking login state:', error);
            });
    </script>
</body>
</html>
	
